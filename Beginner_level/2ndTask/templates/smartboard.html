<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Autocorrect Keyboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body class="bg-gray-900 text-white flex justify-center items-center min-h-screen px-2">
  <div class="w-full max-w-md">
    <h2 class="text-center text-xl mb-4 font-bold text-blue-400">Smartboard Keyboard</h2>
    <textarea id="inputText" class="w-full p-3 text-black rounded mb-3 resize-none" rows="4" placeholder="Type here..."></textarea>
    <div id="suggestionBox" class="text-yellow-400 text-sm mb-2"></div>
    <div class="flex flex-wrap gap-2 mb-4" id="predictionRow"></div>
    <div class="flex gap-2 justify-center mb-2">
      <button onclick="switchLayout('letters')" class="bg-blue-700 px-3 py-1 rounded">ABC</button>
      <button onclick="switchLayout('symbols')" class="bg-blue-700 px-3 py-1 rounded">123</button>
      <button onclick="switchLayout('emoji')" class="bg-blue-700 px-3 py-1 rounded">😊</button>
      <button onclick="toggleShift()" class="bg-purple-700 px-3 py-1 rounded">⇧ Shift</button>
    </div>
    <div id="keyboard" class="bg-gray-800 p-3 rounded-lg shadow-lg text-center text-white text-lg font-semibold flex flex-col max-h-[300px] overflow-hidden">
      <div id="keyboardInner" class="flex-1 overflow-y-auto pr-1 mb-2"></div>
      <button id="spaceKey" class="w-full bg-blue-600 hover:bg-blue-500 rounded py-2 mt-2">Space</button>
    </div>
  </div>

  <script>
    const inputText = document.getElementById("inputText");
    const suggestionBox = document.getElementById("suggestionBox");
    const predictionRow = document.getElementById("predictionRow");
    const keyboardInner = document.getElementById("keyboardInner");
    let isShift = false;
    let currentLayout = 'letters';

    const layouts = {
      letters: [
        "q w e r t y u i o p backspace clear",
        "a s d f g h j k l exclamation quotation apostrophe",
        "z x c v b n m comma colon semicolon period question"
      ],
      symbols: [
        "1 2 3 4 5 6 7 8 9 0 backspace clear",
        "@ # $ % & * ( ) [ ] _ |",
        "- + = / \\ ~ ` ^ < > ! ?"
      ],
      emoji: [
        "😀 😃 😄 😁 😆 😂 🤣 😊",
        "😇 🙂 🙃 😉 😌 😍 🥰 😘",
        "😗 😙 😋 😛 🤩 🥳 😭 🤗",
        "🤔 🫣 🤭 😡 🫡 🤫 😫 🥺",
        "😳 😱 😨 😰 😢 😓 🥵 🥶",
        "😴 💤 🤤 😵 🥴 🤯 🥳 🤠",
        "😎 🧐 🤓 😺 😸 😹 😻 😼",
        "😽 🙀 😿 😾 🐱 🐶 🐭 🐹",
        "🐰 🦊 🐻 🐼 🐨 🐯 🦁 🐮",
        "🐷 🐽 🐸 🐵 🙈 🙉 🙊 🐒",
        "🐔 🐧 🐦 🐤 🐣 🐥 🦆 🦅",
        "🦉 🦇 🐺 🐗 🐴 🦄 🐝 🐛",
        "🐌 🐞 🦗 🕷️ 🕸️ 🦂 🦟 🦠",
        "🦀 🐡 🐠 🐟 🐬 🐳 🐋 🦈",
        "🐊 🐢 🦎 🐍 🐙 🦑 🦐 🦞",
        "🦀 🐚 🐌 🐛 🦋 🐜 🐝 🐞",
        "🐢 🐍 🦎 🐊 🐳 🐬 🐠 🐟"
      ]
    };

    const symbolMap = {
      comma: ",",
      period: ".",
      question: "?",
      exclamation: "!",
      quotation: "\"",
      apostrophe: "'",
      colon: ":",
      semicolon: ";",
      backspace: "←",
      clear: "⨉"
    };

    function renderKeyboard() {
      keyboardInner.innerHTML = "";
      layouts[currentLayout].forEach(row => {
        row.split(" ").forEach(key => {
          const btn = document.createElement("button");
          btn.textContent = symbolMap[key] || (isShift ? key.toUpperCase() : key);
          btn.className = "bg-gray-700 hover:bg-gray-600 rounded py-2 px-2 m-0.5";
          btn.onclick = () => {
            if (key === "backspace") {
              inputText.value = inputText.value.slice(0, -1);
            } else if (key === "clear") {
              inputText.value = "";
            } else {
              const char = symbolMap[key] || key;
              inputText.value += isShift ? char.toUpperCase() : char;
            }
            inputText.dispatchEvent(new Event("input"));
          };
          keyboardInner.appendChild(btn);
        });
        const br = document.createElement("div");
        br.className = "w-full h-1";
        keyboardInner.appendChild(br);
      });
    }

    document.getElementById("spaceKey").onclick = () => {
      inputText.value += " ";
      inputText.dispatchEvent(new Event("input"));
    };

    function switchLayout(layout) {
      currentLayout = layout;
      renderKeyboard();
    }

    function toggleShift() {
      isShift = !isShift;
      renderKeyboard();
    }

    inputText.addEventListener("input", async () => {
      const response = await fetch("/autocorrect", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: inputText.value })
      });
      const data = await response.json();
      const words = inputText.value.trim().split(" ");
      const lastWord = words[words.length - 1];
      suggestionBox.innerHTML = "";
      if (data.suggestion && data.suggestion !== lastWord) {
        const btn = document.createElement("button");
        btn.textContent = `Did you mean: "${data.suggestion}"? Click to apply`;
        btn.className = "underline hover:text-white";
        btn.onclick = () => {
          words[words.length - 1] = data.suggestion;
          inputText.value = words.join(" ") + " ";
          inputText.dispatchEvent(new Event("input"));
        };
        suggestionBox.appendChild(btn);
      }
      predictionRow.innerHTML = "";
      data.predictions.forEach(word => {
        const btn = document.createElement("button");
        btn.textContent = word;
        btn.className = "bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm";
        btn.onclick = () => {
          inputText.value += " " + word;
          inputText.dispatchEvent(new Event("input"));
        };
        predictionRow.appendChild(btn);
      });
    });

    renderKeyboard();
  </script>
</body>
</html>
